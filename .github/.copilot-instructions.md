
# GitHub Copilot Context Document for DeanmachinesAI

# This document provides context for the DeanmachinesAI project to assist GitHub Copilot in generating code, debugging, and understanding the project's architecture and conventions

**GitHub Copilot Context Document: DeanmachinesAI (Final Version)**

**Generated by:** Codex, the Software Cartographer
**Date:** April 9, 2025
**Version:** 2.0 (Final Comprehensive Version)

**1. Purpose & Scope:**

* **Goal:** This document provides comprehensive context about the DeanmachinesAI project to enable GitHub Copilot to generate accurate, relevant, and high-quality code, assist in debugging, and understand the project's architecture and conventions.
* **Scope:** Based on analysis of project files (primarily `src/mastra/` directory and root configurations), user feedback, and inferred project goals. Covers architecture, components, data flow, coding standards, and known limitations.
* **Target Audience:** Primarily GitHub Copilot, but also serves as a concise project overview for developers.

**2. How to Use This Document (Guidance for Copilot):**

* **Prioritize Rules:** Adhere strictly to rules marked with `RULE-`. These are mandatory.
* **Follow Conventions:** Adhere to conventions noted in `CONV-` sections.
* **Understand Architecture:** Use `ARCH-` sections for design principles.
* **Identify Components:** Use `COMP-` sections to understand system parts. Refer to `#file:` links for implementation details.
* **Avoid Anti-Patterns:** Avoid patterns marked with `ANTI-`.
* **Handle Gaps:** Explicitly state when encountering information gaps (`GAPS-` section) and request clarification.
* **Provide Feedback:** Follow `RULE-FeedbackLoop` to document findings/completions in `#file:API.md`.
* **Use References:** Utilize `#file:` references for specific code locations.

**3. Project Overview & Goals**

* **FIND-ProjectName:** DeanmachinesAI
* **FIND-ProjectPurpose:** AI-powered platform using the Mastra framework for research, analysis, and content generation. Focuses on automating knowledge work via specialized agents and workflows.
* **FIND-CoreTech:** TypeScript, Node.js, Mastra framework (`@mastra/*`), Google AI (`@google/generative-ai`), Pinecone (vector DB), LibSQL/Turso (memory DB), LangSmith/LangFuse (observability).
* **FIND-KeyFeatures:** Agent-based architecture, RAG pipeline, RL improvement loop, extensive tooling, integrated observability.
* **FB-Plan-Expansion:** Plans include adding specialized Coding and Marketing agent teams, potentially integrating with external platforms like Twitter.

**4. Key Directories/Modules**

* **DIR-SrcMastra (*):** Root for core application logic (`agents/`, `database/`, `services/`, `tools/`, `workflows/`).
* **DIR-Knowledge:** Non-code assets (e.g., `.drawio` diagrams), agent file I/O target/source.
* **DIR-Root:** Project root containing configurations (`package.json`, `tsconfig.json`, `mastra.config.ts`, `.env.example`), `README.md`.

**5. Core Components & Logic (Key components marked with *)**

* **COMP-MastraInstance (*):** Central application object (`src/mastra/index.ts`). Integrates core components. **Note:** Currently receives `memory` globally, which needs refactoring (`#REFACTOR-MemoryInjection`).
* **COMP-Agents (*):** Specialized units (`agents/`). Created via factory (`#RULE-AgentFactory`), defined by config (`#RULE-AgentConfig`). Should receive `memory` individually (`#RULE-MemoryInjection`). *Existing:* Research, Analyst, Writer, RLTrainer, DataManager, AgenticAssistant. *Planned:* Coding & Marketing teams.
* **COMP-Tools (*):** Agent capabilities registry (`#file:src/mastra/tools/index.ts`). Defined via `createTool`, use Zod schemas (`#RULE-ToolSchemas`). Key groups: Search, FileIO, Document Processing, Vector Store Interaction, RL Tools, Memory, ExternalAPI, Utility, Code. *Planned:* Twitter tool.
* **COMP-Services:** External API/SDK wrappers (`src/mastra/services/`). Follow `#RULE-ServiceUsage`.
* **COMP-Database:** Persistence layer.
  * `COMP-DB-Memory (*)`: LibSQL/Turso via `sharedMemory` in `#file:src/mastra/database/index.ts`. **Note:** This instance should be injected per-agent (`#RULE-MemoryInjection`), not globally.
  * `COMP-DB-Vector (*)`: Pinecone in `#file:src/mastra/database/vector-store.ts`. Used for RAG.
* **COMP-Workflows/Networks (*):** Task orchestration (`workflows/`). Linear Workflows (`index.ts`), dynamic AgentNetworks (`Networks/agentNetwork.ts`).

**6. Key Architectural Patterns & Guidance**

* **ARCH-AgentBasedSystem (*):** Core design. Structure features around specialized, collaborating agents. Memory should be scoped per agent (`#RULE-MemoryInjection`).
* **ARCH-ServiceAbstraction (*):** Wrap external dependencies (APIs, SDKs) in dedicated service modules (`src/mastra/services/`). **Guidance:** Improves modularity, testability. See `#RULE-ServiceUsage`.
* **ARCH-ConfigManagement (*):** Use TS config files (`agents/config/`) & `.env` for configuration. **Guidance:** Separates configuration from logic. See `#RULE-AgentConfig`, `#RULE-EnvVars`.
* **ARCH-ToolAugmentation (*):** Define agent capabilities as tools in registry (`#file:src/mastra/tools/index.ts`). **Guidance:** Promotes reuse, modularity. Prefer using existing tools. See `#RULE-ToolRegistry`.
* **ARCH-RLLoop:** System includes RL components (`COMP-RLTrainerAgent`, `COMP-ToolGroup-RL`). **Guidance:** Consider feedback loops for new features.
* **ARCH-RAG:** Leverage vector stores (`#COMP-DB-Vector`) for knowledge retrieval. **Guidance:** Use for tasks requiring access to external knowledge.
* **ARCH-Observability (*):** Integrate tracing/monitoring (`#RULE-Observability`). **Guidance:** Essential for debugging and performance analysis.

**7. Explicit Standards & Rules (Apply these strictly)**

* **RULE-MemoryInjection (*CRITICAL*):** Inject `sharedMemory` (`#COMP-DB-Memory`) directly into individual `Agent` constructors (e.g., within `#file:src/mastra/agents/base.agent.ts`'s `createAgentFromConfig`) using `new Agent({ ..., memory: sharedMemory })`. Do **NOT** pass `memory` globally to the `Mastra` constructor in `#file:src/mastra/index.ts`. **Rationale:** Aligns with Mastra framework best practices for memory scoping and avoids future breaking changes (Ref: Framework Warning `WARN [...] Memory should be added to Agents, not to Mastra`). See `#ANTI-GlobalMemoryInjection` and `#REFACTOR-MemoryInjection`.
* **RULE-AgentFactory (*):** Use `#file:src/mastra/agents/base.agent.ts` (`createAgentFromConfig`) for agent creation. **Rationale:** Ensures consistent agent initialization.
* **RULE-AgentConfig (*):** Define agent configs in `src/mastra/agents/config/` implementing `BaseAgentConfig`. Must include `id`, `name`, `description`, `model`, `instructions`, and `toolIds`. **Rationale:** Centralized definition.
* **RULE-ToolRegistry (*):** Register all tools in `#file:src/mastra/tools/index.ts` using `createTool`. **Rationale:** Discoverability, consistency.
* **RULE-ToolSchemas (*):** Define Zod schemas for all tool inputs/outputs. **Rationale:** Validation, clear interfaces.
* **RULE-Observability (*):** Integrate LangSmith/LangFuse tracing (`#file:src/mastra/services/langsmith.ts`, `#file:src/mastra/services/langfuse.ts`) into significant operations. **Rationale:** Monitoring, debugging.
* **RULE-EnvVars (*):** Source secrets/external config from environment variables (`#file:.env.example`). **Rationale:** Security, environment management.
* **RULE-ServiceUsage:** Use service modules (`src/mastra/services/`) for external API/SDK interactions. **Rationale:** Modularity, testability.
* **RULE-FileAccess:** Restrict filesystem tools generally to `#DIR-Knowledge`. **Rationale:** Security, organization.
* **RULE-FeedbackLoop (*):** When assisting, if you encounter issues, gaps (`GAPS-` section), or potential bugs/violations, **append a note to `#file:API.md`**. Also, **append a note upon successful completion** of significant tasks. Format: `- [Date] Copilot Finding/Completion: [Brief Description] (Relevant File: path/to/file)`. **Rationale:** Creates a feedback loop for improving this context and tracking progress.

**8. Dos and Don'ts (Best Practices & Common Pitfalls)**

* **DO:** Reuse tools from `#SRC-ToolIndex`. Check `allToolsMap` first.
* **DO:** Maintain separation of concerns (`#ARCH-Modularity`).
* **DO:** Use `@mastra/core/logger` for logging.
* **DO:** Add TSDoc explaining the *intent* (why).
* **DO:** Follow config patterns (`#RULE-AgentConfig`, `#RULE-EnvVars`).
* **DO:** Inject memory per agent (`#RULE-MemoryInjection`).
* **DON'T:** Pass memory globally to `Mastra` (`#ANTI-GlobalMemoryInjection`).
* **DON'T:** Call databases directly from Agents (`#ANTI-DirectDBInAgent`).
* **DON'T:** Tightly couple agents (`#ANTI-AgentCoupling`).
* **DON'T:** Hardcode secrets (`#ANTI-HardcodedConfig`).
* **DON'T:** Create monolithic tools (`#ANTI-MonolithicTools`).
* **DON'T:** Bypass tool registry (`#ANTI-IgnoringRegistry`).
* **DON'T:** Neglect observability (`#ANTI-IgnoringObservability`).

**9. Anti-Patterns to Avoid**

* **ANTI-GlobalMemoryInjection (*):** Passing `memory` via `new Mastra({ memory: ... })` in `#file:src/mastra/index.ts`. **Impact:** Deprecated, breaks future compatibility, incorrect scoping. Refactor immediately (`#REFACTOR-MemoryInjection`).
* **ANTI-DirectDBInAgent:** Agents calling DB clients directly. **Impact:** Violates separation, hinders testing.
* **ANTI-AgentCoupling:** Agents directly importing/calling other agents. **Impact:** Rigidity, poor testability. Use Memory/Networks.
* **ANTI-HardcodedConfig:** Secrets/URLs in code. **Impact:** Security risk, deployment complexity. Use Env Vars.
* **ANTI-MonolithicTools:** Overly complex tools. **Impact:** Poor maintainability/reusability. Decompose.
* **ANTI-IgnoringRegistry:** Not registering tools in `#SRC-ToolIndex`. **Impact:** Tools unusable.
* **ANTI-IgnoringObservability:** Not adding tracing. **Impact:** Debugging difficulty, performance blind spots.

**10. Key Context Sources (For Copilot's Reference)**

* **SRC-ThisFile (*):** This document (`.github/copilot-instructions.md`). Primary source for rules and structure.
* **SRC-README:** `README.md` (Overview, diagrams).
* **SRC-CodeBase (*):** `src/mastra/` and root config files.
* **SRC-PackageJson:** `package.json` (Dependencies).
* **SRC-ToolIndex (*):** `src/mastra/tools/index.ts` (Tool definitions).
* **SRC-BaseAgentConfig (*):** `src/mastra/agents/config/base.config.ts` (Agent interface).
* **SRC-EnvExample:** `.env.example` (Env var structure).
* **SRC-ApiMd (*):** `#file:API.md` (Target for feedback loop, per `#RULE-FeedbackLoop`).

**11. Observed Conventions**

* **CONV-FileNaming:** `.agent.ts`, `.config.ts`, etc. Follow pattern.
* **CONV-BarrelExports:** `index.ts` for module exports. Use within modules.
* **CONV-TypeScript:** Strict mode, ESNext. Adhere to strict typing.
* **CONV-ConfigStructure:** Separate config files/dirs. Maintain separation.
* **CONV-ZodSchemas:** Standard for schema validation. Use for new schemas.
* **CONV-Logging:** Use `@mastra/core/logger`.
* **CONV-ExternalConfig:** Use environment variables (`#RULE-EnvVars`).

**12. EXT-CONTEXT: External AI Agent Trends (April 2025)**
*(Source: User request & Google Search. Provides external context for planning).*

* **EXT-TREND-AgenticShift:** Confirms project alignment.
* **EXT-TREND-Specialization:** Validates plans for specialized teams.
* **EXT-TREND-MAS:** Reinforces value of `AgentNetwork`.
* **EXT-TREND-Learning:** Highlights relevance of RL components.
* **EXT-TECH-Frameworks & ToolUse:** Affirms strategy.

**13. Potential Complexities & Refactoring Needs**

* **REFACTOR-MemoryInjection (*):** The current global memory injection pattern (`new Mastra({ memory: ... })`) **must be refactored** to per-agent injection (`new Agent({ memory: ... })`). This is a high-priority task. See `#RULE-MemoryInjection`.
* **COMPLEXITY-ToolInterdependencies:** Debugging tool chains. **Mitigation:** Observability, error handling.
* **COMPLEXITY-AgentCoordination:** Emergent behavior in networks. **Mitigation:** Logging, tracing, simple designs first.
* **COMPLEXITY-RLTraining:** Tuning reward functions. **Mitigation:** Iteration, monitoring.
* **COMPLEXITY-ObservabilityOverhead:** Performance vs. detail. **Mitigation:** Sampling/levels.
* **COMPLEXITY-ToolGaps:** Need for new tools (e.g., AST analysis). **Mitigation:** Early identification.

**14. User Feedback Highlights**

* **FB-Plan-CodingTeam:** Coder, Debugger, Refactorer, Doc, Arch agents.
* **FB-Plan-MarketingTeam:** MarketResearch, Copywriter, SocialMedia, etc.
* **FB-Plan-Tools:** Add Twitter; Assign ArXiv/Wiki to Research, GitHub to Coding.
* **FB-Goal-InstructionFile:** This document guides Copilot.
* **FB-Goal-FeedbackLoop:** Copilot should log findings/completions to `#file:API.md`.
* **FB-Input-MemoryWarning:** User provided critical warning about memory injection.

**15. Key Assumptions & Information Gaps (Context Enhancement Areas)**

* **Guidance:** When assistance requires information from these GAPS, explicitly state the gap ID (e.g., `GAPS-DataSchemas`) and request clarification from the user. Follow `#RULE-FeedbackLoop`.
* **ASSUM-MapAccuracy:** Assumes `repomix.txt` is accurate.
* **ASSUM-FrameworkUsage:** Assumes standard Mastra patterns (except where warning indicates deviation).
* **GAPS-ObscuredLogic (*):** Internal function logic (`⋮----`) hidden. **Impact:** Limits understanding for refactoring/debugging internal algorithms. **User Action Needed:** Provide explanations/pseudocode for key algorithms.
* **GAPS-RuntimeDetails (*):** Runtime behavior/errors unknown from static analysis. **Impact:** Cannot predict runtime issues. **User Action Needed:** Define project's error handling strategy (`GAPS-ErrorHandling`).
* **GAPS-IgnoredFiles:** `.env` content unknown. **Impact:** Actual deployment configs unknown.
* **GAPS-AgentInstructions (*):** The *content* of `BaseAgentConfig.instructions` is unknown. **Impact:** Agent behavior hard to predict accurately. **User Action Needed:** Provide summaries/excerpts if needed.
* **GAPS-DataSchemas (*):** Exact structure of data in `sharedMemory` (RL data, agent state) and Pinecone metadata undefined here. **Impact:** May generate incorrect data manipulation code. **User Action Needed:** Provide interfaces/examples.
* **GAPS-ErrorHandling (*):** Project's specific error handling philosophy undefined. **Impact:** Suggestions may not align. **User Action Needed:** Document strategy.
* **GAPS-Algorithms (*):** Detailed logic for key algorithms (RL, GraphRAG) missing. **Impact:** Copilot treats complex logic as black box. **User Action Needed:** Add high-level explanations/pseudocode.
* **GAPS-SDKUsage:** Project-specific patterns for external SDKs not detailed. **Impact:** Suggestions might be generic. **User Action Needed:** Document key SDK usage patterns.
* **GAPS-Testing:** Testing strategy details missing. **Impact:** Cannot generate aligned tests. **User Action Needed:** Document testing approach.

**16. Suggested Copilot Interactions**

* **SUG-RefactorMemory (*):** "Help refactor the memory injection. Remove the `memory` property from the `Mastra` constructor in `#file:src/mastra/index.ts` and ensure `sharedMemory` is correctly passed to the `Agent` constructor within `#file:src/mastra/agents/base.agent.ts`'s `createAgentFromConfig`, following `#RULE-MemoryInjection`. Log completion to `#file:API.md`."
* **SUG-NewAgent:** "Create agent config `coder.config.ts` following `#RULE-AgentConfig`, including tool IDs for `#COMP-ToolGroup-FileIO`, `#COMP-ToolGroup-Code`, `#COMP-ToolGroup-Memory`, `#COMP-ToolGroup-Search`, GitHub tool. Log completion to `#file:API.md`."
* **SUG-AssignTool:** "Add ArXiv/Wikipedia tool IDs (from `#SRC-ToolIndex`) to `toolIds` in `#file:src/mastra/agents/config/research.config.ts`."
* **SUG-NewToolImpl:** "Implement Twitter tool `src/mastra/tools/twitter.ts` following `#RULE-ToolSchemas`, `#RULE-EnvVars`, `#RULE-Observability`. Log completion or issues to `#file:API.md`."
* **SUG-RegisterTool:** "Register `twitterPostTool` in `#SRC-ToolIndex` following `#RULE-ToolRegistry`."
* **SUG-CrossTeamNetwork:** "Define `ProductLaunchNetwork` in `#file:src/mastra/workflows/Networks/agentNetwork.ts` including 'CodeDocumenterAgent', 'CopywriterAgent'."
* **SUG-MemoryInteraction:** "Show how Marketing agents read data written by Coding agents via `memoryQueryTool` targeting `sharedMemory` (`#RULE-MemoryAccess`)."
* **SUG-AddObservability:** "Add LangSmith/LangFuse tracing to the `execute` function of the `graphRagQueryTool` following `#RULE-Observability`."
* **SUG-ApplyRule:** "Review `#file:src/mastra/services/exasearch.ts`. Does it follow `#RULE-EnvVars`? Log findings to `#file:API.md`."
* **SUG-FillGap:** "I need to generate code interacting with RL feedback data, but the schema is unclear (`#GAPS-DataSchemas`). Please provide the interface or an example. Logged gap to `#file:API.md`."

**17. References for Copilot Chat**

* `@workspace`
* `#file:src/mastra/index.ts` (`#COMP-MastraInstance`)
* `#file:src/mastra/tools/index.ts` (`#SRC-ToolIndex`)
* `#file:src/mastra/agents/base.agent.ts` (`#RULE-AgentFactory`)
* `#file:src/mastra/agents/config/base.config.ts` (`#SRC-BaseAgentConfig`)
* `#file:src/mastra/database/index.ts` (`#COMP-DB-Memory`)
* `#file:src/mastra/database/vector-store.ts` (`#COMP-DB-Vector`)
* `#file:src/mastra/workflows/Networks/agentNetwork.ts`
* `#file:README.md` (`#SRC-README`)
* `#file:.env.example` (`#SRC-EnvExample`)
* `#file:API.md` (`#SRC-ApiMd`, `#RULE-FeedbackLoop`)
* Specific Agent Configs (e.g., `#file:src/mastra/agents/config/research.config.ts`)
* Specific Tool Files (e.g., `#file:src/mastra/tools/readwrite.ts`)
* Specific Service Files (e.g., `#file:src/mastra/services/langfuse.ts`)

---

This version incorporates the feedback loop mechanism and highlights the critical memory injection issue, providing a more comprehensive and actionable context document for GitHub Copilot. Remember to keep this document updated as the project evolves.
